{% extends "base.html" %}

{% block title %}Ocean Stressors{% endblock %}

{% block head %}
{{ super() }}
    <link rel='stylesheet' href="{{ url_for('static', filename = 'leaflet.css') }}" />
    <script src="{{ url_for('static', filename = 'leaflet.js') }}"></script>

    <script src="{{ url_for('static', filename = 'L.Map.Sync.js') }}"></script>
{% endblock %}


{% block styles %}
{{ super() }}
    <style type='text/css'>
        .mapContainer { display: inline-block; margin-left: 10px; margin-top: 10px;}
        .title { font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center; }
        .map { width: 400px; height: 400px; }
        .key { text-align: center; margin: auto; }
        .key img { width: 400px; height: 50px; max-width: 400px; }
	.leaflet-bar a, .leaflet-bar a:hover {
    		height: 16px;
    		line-height: 16px;
    		width: 16px;
	}
	.leaflet-control-zoom-in, .leaflet-control-zoom-out {
    		font-size: 14px;
		text-indent: 0px;
	}
    </style>
{% endblock %}


{% block page_content %}
<div class='mapContainer'>
   <div id='title1' class='title'></div>
   <div id='map1' class='map'></div>
   <div id='key1' class='key'><img /></div>
</div>

<div class='mapContainer'>
   <div id='title2' class='title'></div>
   <div id='map2' class='map'></div>
   <div id='key2' class='key'><img /></div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script type='text/javascript'>

//===============================================
var crs = L.CRS.EPSG4326;

var map = [];
var wmspyferret_var = [];
var frontiers = [];

//===============================================
wmspyferret_var[1] = L.tileLayer.wms('/wms_pyferret', {
	command: 'shade/x=-180:180/y=-90:90/lev=20v/pal=mpl_PSU_inferno',
	variable: 'temp[k=@max]',
    	crs: crs,
	format: 'image/png',
	transparent: true,
    	uppercase: true
});
frontiers[1] = L.tileLayer.wms('http://www.globalcarbonatlas.org/geoserver/GCA/wms', {
	layers: 'GCA:GCA_frontiersCountryAndRegions',
	format: 'image/png',
    	crs: crs,
	transparent: true
});

map[1] = L.map('map1', {
    layers: [wmspyferret_var[1], frontiers[1]],
    crs: crs,
    center: [0,-40],
    zoom: 1,
    attributionControl: false
});

//===============================================
wmspyferret_var[2] = L.tileLayer.wms('http://webportals.ipsl.jussieu.fr/gunicorn', {
	command: 'shade/x=-180:180/y=-90:90/lev=20v/pal=mpl_PSU_inferno',
	variable: 'salt[k=@max]',
    	crs: crs,
	format: 'image/png',
	transparent: true,
    	uppercase: true
});
frontiers[2] = L.tileLayer.wms('http://www.globalcarbonatlas.org/geoserver/GCA/wms', {
	layers: 'GCA:GCA_frontiersCountryAndRegions',
	format: 'image/png',
    	crs: crs,
	transparent: true
});

map[2] = L.map('map2', {
    layers: [wmspyferret_var[2], frontiers[2]],
    crs: crs,
    center: [0,-40],
    zoom: 1,
    attributionControl: false
});

//===============================================
// Set up synchro between maps
map[1].sync(map[2]);
map[2].sync(map[1]);

//===============================================
for (mapId = 1; mapId <= 2 ; mapId++) { 
	$('#key'+mapId).children('img').attr('src', 'http://webportals.ipsl.jussieu.fr/gunicorn/?SERVICE=WMS&REQUEST=GetColorBar' +
						'&COMMAND=' + wmspyferret_var[mapId].wmsParams.command +
						'&VARIABLE=' + wmspyferret_var[mapId].wmsParams.variable.replace('+','%2B'));
}

//===============================================

</script>
{% endblock %}

